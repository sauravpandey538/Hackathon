"use strict";(()=>{var e={};e.id=908,e.ids=[908],e.modules={8802:e=>{e.exports=require("bcrypt")},4802:e=>{e.exports=require("cookie")},5142:e=>{e.exports=require("dotenv")},9344:e=>{e.exports=require("jsonwebtoken")},514:e=>{e.exports=require("knex")},1287:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8284:(e,r,s)=>{s.r(r),s.d(r,{config:()=>f,default:()=>m,routeModule:()=>g});var t={};s.r(t),s.d(t,{default:()=>handler});var a=s(1802),n=s(7153),o=s(6249),i=s(7652),u=s(8802),d=s.n(u),l=s(9344),p=s.n(l),c=s(4802);async function handler(e,r){if("POST"!==e.method)return r.status(405).json({status:!1,error:"Method not allowed"});try{let{email:s,password:t}=e.body,a=await (0,i.Z)("users").where({email:s}).first();if(!a)return r.status(400).json({message:"User not found"});if("admin"!==a.role)return r.status(400).json({message:"Access denied"});let n=await d().compare(t,a.password);if(!n)return r.status(400).json({message:"Invalid password"});let o=p().sign({id:a.id,email:a.email,name:a.name},process.env.JWT_SECRET,{expiresIn:"1h"});return r.setHeader("Set-Cookie",(0,c.serialize)("token",o,{httpOnly:!0,secure:!0,maxAge:3600,path:"/",sameSite:"none"})),r.status(200).json({status:!0,message:"Login successful"})}catch(e){return r.status(500).json({status:!1,error:e.message||"Internal server error"})}}let m=(0,o.l)(t,"default"),f=(0,o.l)(t,"config"),g=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/auth/login",pathname:"/api/auth/login",bundlePath:"",filename:""},userland:t})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[222,602],()=>__webpack_exec__(8284));module.exports=s})();