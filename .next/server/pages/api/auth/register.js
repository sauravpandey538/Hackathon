"use strict";(()=>{var e={};e.id=7,e.ids=[7],e.modules={8802:e=>{e.exports=require("bcrypt")},4802:e=>{e.exports=require("cookie")},5142:e=>{e.exports=require("dotenv")},9344:e=>{e.exports=require("jsonwebtoken")},514:e=>{e.exports=require("knex")},1287:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6135:(e,r,s)=>{s.r(r),s.d(r,{config:()=>x,default:()=>m,routeModule:()=>g});var t={};s.r(t),s.d(t,{default:()=>handler});var a=s(1802),i=s(7153),n=s(6249),u=s(7652),o=s(8802),d=s.n(o),l=s(9344),p=s.n(l),c=s(4802);async function handler(e,r){try{let{name:s,email:t,password:a,role:i,secret_key:n}=e.body;if(n!==process.env.ADMIN_SECRET_KEY)return r.status(401).json({message:"Unauthorized"});let o=await (0,u.Z)("users").where({email:t}).first();if(o)return r.status(400).json({message:"User already exists"});let l=await d().hash(a,10),[m]=await (0,u.Z)("users").insert({name:s,email:t,password:l,role:i}).returning("*"),x=p().sign({id:m.id,email:m.email,name:m.name},process.env.JWT_SECRET,{expiresIn:"1h"});return r.setHeader("Set-Cookie",(0,c.serialize)("token",x,{httpOnly:!0,secure:!0,maxAge:3600,path:"/",sameSite:"none"})),r.status(200).json({status:!0,message:"User created successfully"})}catch(e){return r.status(500).json({status:!1,error:e.message||"Internal server error"})}}let m=(0,n.l)(t,"default"),x=(0,n.l)(t,"config"),g=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/auth/register",pathname:"/api/auth/register",bundlePath:"",filename:""},userland:t})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[222,602],()=>__webpack_exec__(6135));module.exports=s})();