"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(middleware)/./node_modules/next/dist/esm/server/web/exports/next-response.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/webapi/jwt/verify.js\");\n\n\n// Define role-based route mappings with exact paths\nconst roleRoutes = {\n    admin: [\n        \"/admin\"\n    ],\n    teacher: [\n        \"/teacher\"\n    ],\n    student: [\n        \"/student\"\n    ]\n};\n// Define public routes that don't require authentication\nconst publicRoutes = [\n    \"/\",\n    \"/admin/auth/login\",\n    \"/admin/auth/signup\",\n    \"/teacher/auth/login\",\n    \"/student/auth/login\",\n    \"/api/auth/login\",\n    \"/api/auth/signup\"\n];\n// Define API routes that require authentication\nconst protectedApiRoutes = [\n    \"/api/teachers\",\n    \"/api/students\",\n    \"/api/routines\"\n];\nasync function middleware(request) {\n    const url = request.nextUrl;\n    const pathname = url.pathname;\n    // Allow public routes without authentication\n    if (publicRoutes.some((route)=>pathname === route || pathname.startsWith(route + \"/\"))) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n    }\n    // Get the token from cookies\n    const token = request.cookies.get(\"token\")?.value;\n    // If no token is present, redirect to login\n    if (!token) {\n        const redirectUrl = new URL(\"/admin/auth/login\", request.url);\n        redirectUrl.searchParams.set(\"redirect\", pathname + url.search);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(redirectUrl);\n    }\n    try {\n        // Verify the token\n        const secret = new TextEncoder().encode(process.env.JWT_SECRET);\n        const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_1__.jwtVerify)(token, secret);\n        // Extract user role from token\n        const userRole = payload.role;\n        // Get the first path segment to determine the route type\n        const firstPathSegment = pathname.split(\"/\")[1];\n        // Check if the user is trying to access a route for their role\n        const isAllowedRoute = firstPathSegment === userRole;\n        // If trying to access a route not for their role, redirect to their dashboard\n        if (!isAllowedRoute) {\n            const dashboardRoute = `/${userRole}/dashboard`;\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(dashboardRoute, request.url));\n        }\n        // For API routes, add the user role to the request headers\n        if (pathname.startsWith(\"/api\") && protectedApiRoutes.some((route)=>pathname.startsWith(route))) {\n            const requestHeaders = new Headers(request.headers);\n            requestHeaders.set(\"x-user-role\", userRole);\n            requestHeaders.set(\"x-user-id\", payload.sub);\n            // Return a new response with the modified headers\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next({\n                request: {\n                    headers: requestHeaders\n                }\n            });\n        }\n        // Allow access to the requested route\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n    } catch (error) {\n        // Token is invalid or expired\n        console.error(\"Token validation error:\", error);\n        // Clear the invalid token\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/admin/auth/login\", request.url));\n        response.cookies.delete(\"token\");\n        return response;\n    }\n}\n// Configure which routes the middleware should run on\nconst config = {\n    matcher: [\n        /*\n     * Match all request paths except:\n     * 1. /_next/ (Next.js internals)\n     * 2. /_static (inside /public)\n     * 3. /_vercel (Vercel internals)\n     * 4. /favicon.ico, /sitemap.xml (static files)\n     */ \"/((?!_next|_static|_vercel|favicon.ico|sitemap.xml).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxNQUFNRSxTQUFTO0lBQ3BCQyxTQUFTO1FBQ1A7Ozs7OztLQU1DLEdBQ0Q7S0FDRDtBQUNILEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vc3JjL21pZGRsZXdhcmUudHM/ZDE5OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBqd3RWZXJpZnkgfSBmcm9tICdqb3NlJ1xuXG4vLyBEZWZpbmUgcm9sZS1iYXNlZCByb3V0ZSBtYXBwaW5ncyB3aXRoIGV4YWN0IHBhdGhzXG5jb25zdCByb2xlUm91dGVzID0ge1xuICBhZG1pbjogWycvYWRtaW4nXSxcbiAgdGVhY2hlcjogWycvdGVhY2hlciddLFxuICBzdHVkZW50OiBbJy9zdHVkZW50J10sXG59XG5cbi8vIERlZmluZSBwdWJsaWMgcm91dGVzIHRoYXQgZG9uJ3QgcmVxdWlyZSBhdXRoZW50aWNhdGlvblxuY29uc3QgcHVibGljUm91dGVzID0gW1xuICAnLycsXG4gICcvYWRtaW4vYXV0aC9sb2dpbicsXG4gICcvYWRtaW4vYXV0aC9zaWdudXAnLFxuICAnL3RlYWNoZXIvYXV0aC9sb2dpbicsXG4gICcvc3R1ZGVudC9hdXRoL2xvZ2luJyxcbiAgJy9hcGkvYXV0aC9sb2dpbicsXG4gICcvYXBpL2F1dGgvc2lnbnVwJyxcbl1cblxuLy8gRGVmaW5lIEFQSSByb3V0ZXMgdGhhdCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXG5jb25zdCBwcm90ZWN0ZWRBcGlSb3V0ZXMgPSBbXG4gICcvYXBpL3RlYWNoZXJzJyxcbiAgJy9hcGkvc3R1ZGVudHMnLFxuICAnL2FwaS9yb3V0aW5lcycsXG5dXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHVybCA9IHJlcXVlc3QubmV4dFVybFxuICBjb25zdCBwYXRobmFtZSA9IHVybC5wYXRobmFtZVxuICBcbiAgLy8gQWxsb3cgcHVibGljIHJvdXRlcyB3aXRob3V0IGF1dGhlbnRpY2F0aW9uXG4gIGlmIChwdWJsaWNSb3V0ZXMuc29tZShyb3V0ZSA9PiBwYXRobmFtZSA9PT0gcm91dGUgfHwgcGF0aG5hbWUuc3RhcnRzV2l0aChyb3V0ZSArICcvJykpKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KClcbiAgfVxuICBcbiAgLy8gR2V0IHRoZSB0b2tlbiBmcm9tIGNvb2tpZXNcbiAgY29uc3QgdG9rZW4gPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KCd0b2tlbicpPy52YWx1ZVxuICBcbiAgLy8gSWYgbm8gdG9rZW4gaXMgcHJlc2VudCwgcmVkaXJlY3QgdG8gbG9naW5cbiAgaWYgKCF0b2tlbikge1xuICAgIGNvbnN0IHJlZGlyZWN0VXJsID0gbmV3IFVSTCgnL2FkbWluL2F1dGgvbG9naW4nLCByZXF1ZXN0LnVybClcbiAgICByZWRpcmVjdFVybC5zZWFyY2hQYXJhbXMuc2V0KCdyZWRpcmVjdCcsIHBhdGhuYW1lICsgdXJsLnNlYXJjaClcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KHJlZGlyZWN0VXJsKVxuICB9XG4gIFxuICB0cnkge1xuICAgIC8vIFZlcmlmeSB0aGUgdG9rZW5cbiAgICBjb25zdCBzZWNyZXQgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUocHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCEpXG4gICAgY29uc3QgeyBwYXlsb2FkIH0gPSBhd2FpdCBqd3RWZXJpZnkodG9rZW4sIHNlY3JldClcbiAgICBcbiAgICAvLyBFeHRyYWN0IHVzZXIgcm9sZSBmcm9tIHRva2VuXG4gICAgY29uc3QgdXNlclJvbGUgPSBwYXlsb2FkLnJvbGUgYXMgc3RyaW5nXG4gICAgXG4gICAgLy8gR2V0IHRoZSBmaXJzdCBwYXRoIHNlZ21lbnQgdG8gZGV0ZXJtaW5lIHRoZSByb3V0ZSB0eXBlXG4gICAgY29uc3QgZmlyc3RQYXRoU2VnbWVudCA9IHBhdGhuYW1lLnNwbGl0KCcvJylbMV1cbiAgICBcbiAgICAvLyBDaGVjayBpZiB0aGUgdXNlciBpcyB0cnlpbmcgdG8gYWNjZXNzIGEgcm91dGUgZm9yIHRoZWlyIHJvbGVcbiAgICBjb25zdCBpc0FsbG93ZWRSb3V0ZSA9IGZpcnN0UGF0aFNlZ21lbnQgPT09IHVzZXJSb2xlXG4gICAgXG4gICAgLy8gSWYgdHJ5aW5nIHRvIGFjY2VzcyBhIHJvdXRlIG5vdCBmb3IgdGhlaXIgcm9sZSwgcmVkaXJlY3QgdG8gdGhlaXIgZGFzaGJvYXJkXG4gICAgaWYgKCFpc0FsbG93ZWRSb3V0ZSkge1xuICAgICAgY29uc3QgZGFzaGJvYXJkUm91dGUgPSBgLyR7dXNlclJvbGV9L2Rhc2hib2FyZGBcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChkYXNoYm9hcmRSb3V0ZSwgcmVxdWVzdC51cmwpKVxuICAgIH1cbiAgICBcbiAgICAvLyBGb3IgQVBJIHJvdXRlcywgYWRkIHRoZSB1c2VyIHJvbGUgdG8gdGhlIHJlcXVlc3QgaGVhZGVyc1xuICAgIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpJykgJiYgcHJvdGVjdGVkQXBpUm91dGVzLnNvbWUocm91dGUgPT4gcGF0aG5hbWUuc3RhcnRzV2l0aChyb3V0ZSkpKSB7XG4gICAgICBjb25zdCByZXF1ZXN0SGVhZGVycyA9IG5ldyBIZWFkZXJzKHJlcXVlc3QuaGVhZGVycylcbiAgICAgIHJlcXVlc3RIZWFkZXJzLnNldCgneC11c2VyLXJvbGUnLCB1c2VyUm9sZSlcbiAgICAgIHJlcXVlc3RIZWFkZXJzLnNldCgneC11c2VyLWlkJywgcGF5bG9hZC5zdWIgYXMgc3RyaW5nKVxuICAgICAgXG4gICAgICAvLyBSZXR1cm4gYSBuZXcgcmVzcG9uc2Ugd2l0aCB0aGUgbW9kaWZpZWQgaGVhZGVyc1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KHtcbiAgICAgICAgcmVxdWVzdDoge1xuICAgICAgICAgIGhlYWRlcnM6IHJlcXVlc3RIZWFkZXJzLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG4gICAgXG4gICAgLy8gQWxsb3cgYWNjZXNzIHRvIHRoZSByZXF1ZXN0ZWQgcm91dGVcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIFRva2VuIGlzIGludmFsaWQgb3IgZXhwaXJlZFxuICAgIGNvbnNvbGUuZXJyb3IoJ1Rva2VuIHZhbGlkYXRpb24gZXJyb3I6JywgZXJyb3IpXG4gICAgXG4gICAgLy8gQ2xlYXIgdGhlIGludmFsaWQgdG9rZW5cbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvYWRtaW4vYXV0aC9sb2dpbicsIHJlcXVlc3QudXJsKSlcbiAgICByZXNwb25zZS5jb29raWVzLmRlbGV0ZSgndG9rZW4nKVxuICAgIFxuICAgIHJldHVybiByZXNwb25zZVxuICB9XG59XG5cbi8vIENvbmZpZ3VyZSB3aGljaCByb3V0ZXMgdGhlIG1pZGRsZXdhcmUgc2hvdWxkIHJ1biBvblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgbWF0Y2hlcjogW1xuICAgIC8qXG4gICAgICogTWF0Y2ggYWxsIHJlcXVlc3QgcGF0aHMgZXhjZXB0OlxuICAgICAqIDEuIC9fbmV4dC8gKE5leHQuanMgaW50ZXJuYWxzKVxuICAgICAqIDIuIC9fc3RhdGljIChpbnNpZGUgL3B1YmxpYylcbiAgICAgKiAzLiAvX3ZlcmNlbCAoVmVyY2VsIGludGVybmFscylcbiAgICAgKiA0LiAvZmF2aWNvbi5pY28sIC9zaXRlbWFwLnhtbCAoc3RhdGljIGZpbGVzKVxuICAgICAqL1xuICAgICcvKCg/IV9uZXh0fF9zdGF0aWN8X3ZlcmNlbHxmYXZpY29uLmljb3xzaXRlbWFwLnhtbCkuKiknLFxuICBdLFxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImp3dFZlcmlmeSIsInJvbGVSb3V0ZXMiLCJhZG1pbiIsInRlYWNoZXIiLCJzdHVkZW50IiwicHVibGljUm91dGVzIiwicHJvdGVjdGVkQXBpUm91dGVzIiwibWlkZGxld2FyZSIsInJlcXVlc3QiLCJ1cmwiLCJuZXh0VXJsIiwicGF0aG5hbWUiLCJzb21lIiwicm91dGUiLCJzdGFydHNXaXRoIiwibmV4dCIsInRva2VuIiwiY29va2llcyIsImdldCIsInZhbHVlIiwicmVkaXJlY3RVcmwiLCJVUkwiLCJzZWFyY2hQYXJhbXMiLCJzZXQiLCJzZWFyY2giLCJyZWRpcmVjdCIsInNlY3JldCIsIlRleHRFbmNvZGVyIiwiZW5jb2RlIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJwYXlsb2FkIiwidXNlclJvbGUiLCJyb2xlIiwiZmlyc3RQYXRoU2VnbWVudCIsInNwbGl0IiwiaXNBbGxvd2VkUm91dGUiLCJkYXNoYm9hcmRSb3V0ZSIsInJlcXVlc3RIZWFkZXJzIiwiSGVhZGVycyIsImhlYWRlcnMiLCJzdWIiLCJlcnJvciIsImNvbnNvbGUiLCJyZXNwb25zZSIsImRlbGV0ZSIsImNvbmZpZyIsIm1hdGNoZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});